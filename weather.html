<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天气7.4</title>
    <style>
        /* 全局重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", Arial, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* 日夜模式基础样式 */
        body {
            background-color: #f5f5f5;
            padding-bottom: 40px;
        }
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        /* 容器宽度统一 */
        .container {
            width: 1200px;
            margin: 0 auto;
        }

        /* 头部区域（LOGO + 搜索框 + 日夜模式切换） */
        .header {
            background-color: #fff;
            padding: 10px 0;
            border-bottom: 1px solid #e5e5e5;
        }
        body.dark-mode .header {
            background-color: #2d2d2d;
            border-bottom: 1px solid #444;
        }
        .header-wrap {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }
        .logo-container {
            width: 350px;
            height: 100%;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #00529b;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        body.dark-mode .logo-container {
            color: #4da6ff;
        }
        .logo-container:hover {
            color: #0066cc;
            transform: scale(1.02);
        }
        body.dark-mode .logo-container:hover {
            color: #66b3ff;
        }
        .logo-container i {
            font-size: 36px;
        }

        /* 搜索框容器 */
        .search-container {
            width: 350px;
            height: 45px;
            display: flex;
            align-items: center;
            padding: 0 5px;
            transition: all 0.3s ease;
        }
        .search-container:hover {
            box-shadow: 0 0 8px rgba(0, 82, 155, 0.2);
        }
        body.dark-mode .search-container:hover {
            box-shadow: 0 0 8px rgba(77, 166, 255, 0.2);
        }
        #cityInput {
            flex: 1;
            height: 35px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
            padding: 0 15px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background-color: #fff;
            color: #333;
        }
        body.dark-mode #cityInput {
            background-color: #333;
            border-color: #555;
            color: #e0e0e0;
        }
        #cityInput:focus {
            border-color: #00529b;
        }
        body.dark-mode #cityInput:focus {
            border-color: #4da6ff;
        }
        #searchBtn {
            height: 35px;
            width: 80px;
            background-color: #00529b;
            color: #fff;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        body.dark-mode #searchBtn {
            background-color: #0066cc;
        }
        #searchBtn:hover {
            background-color: #0066cc;
            box-shadow: 0 2px 6px rgba(0, 82, 155, 0.3);
        }
        body.dark-mode #searchBtn:hover {
            background-color: #1a75ff;
            box-shadow: 0 2px 6px rgba(77, 166, 255, 0.3);
        }

        /* 日夜模式切换按钮 */
        .theme-toggle {
            width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background-color: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        body.dark-mode .toggle-switch {
            background-color: #4da6ff;
        }
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        body.dark-mode .toggle-slider {
            transform: translateX(26px);
        }
        .theme-text {
            font-size: 14px;
            color: #666;
        }
        body.dark-mode .theme-text {
            color: #ccc;
        }

        /* 导航栏区域 */
        .nav-bar {
            background-color: #00529b;
            height: 45px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode .nav-bar {
            background-color: #004080;
        }
        .nav-wrap {
            display: flex;
            height: 100%;
        }
        .nav-item {
            flex: 1;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background-color: #fff;
            transition: width 0.3s ease;
        }
        .nav-item:hover {
            background-color: #0066cc;
        }
        body.dark-mode .nav-item:hover {
            background-color: #0073e6;
        }
        .nav-item:hover::after {
            width: 100%;
        }

        /* 天气主内容区域 */
        .weather-main {
            margin-top: 15px;
            background-color: #0b6bb8;
            height: 240px;
            display: flex;
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        body.dark-mode .weather-main {
            background-color: #004a80;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .weather-main:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        body.dark-mode .weather-main:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
        }

        /* 当前天气容器 */
        .current-weather-container {
            width: 30%;
            height: 100%;
            padding: 15px;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s ease;
        }
        .current-weather-container:hover {
            background-color: #0a64aa;
        }
        body.dark-mode .current-weather-container:hover {
            background-color: #005599;
        }
        .city-time-container {
            height: 40px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            font-size: 14px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .city-time-container:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .temp-container {
            height: 80px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .temp-container:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.03);
        }
        /* 修改：Font Awesome 天气图标样式 */
        .weather-icon {
            font-size: 50px;
            transition: all 0.3s ease;
            color: #fff;
        }
        .temp-container:hover .weather-icon {
            transform: rotate(5deg);
        }
        .forecast-icon {
            font-size: 40px;
            transition: all 0.3s ease;
            color: #fff;
        }
        .forecast-day-container:hover .forecast-icon {
            transform: scale(1.2);
        }
        .temp-value {
            font-size: 30px;
            font-weight: bold;
        }
        .details-container {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }
        .detail-item {
            width: 22%;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            gap: 6px;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .detail-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        body.dark-mode .detail-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }
        .detail-item span:first-child {
            font-size: 14px;
            font-weight: bold;
        }
        .detail-item span:last-child {
            font-size: 16px;
            font-weight: normal;
        }

        /* 未来几天预报容器 */
        .forecast-container {
            width: 70%;
            height: 100%;
            display: flex;
            padding: 15px 0;
        }
        .forecast-day-container {
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            padding: 15px 5px;
            gap: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
            cursor: pointer;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .forecast-day-container {
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        .forecast-day-container:last-child {
            border-right: none;
        }
        .forecast-day-container:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
            z-index: 10;
            border-radius: 8px;
        }
        body.dark-mode .forecast-day-container:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .forecast-date {
            color: #e0e0e0;
            font-size: 12px;
        }
        .forecast-temp {
            font-size: 16px;
            font-weight: 500;
        }
        .forecast-text {
            margin: 2px 0;
            font-size: 13px;
        }
        .forecast-wind-scale {
            font-size: 12px;
            color: #e0e0e0;
        }

        /* 天气提示模块 */
        .weather-tips-section {
            width: 1200px;
            margin: 20px auto 0;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        body.dark-mode .weather-tips-section {
            background-color: #2d2d2d;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .tips-title {
            font-size: 18px;
            color: #00529b;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 10px;
        }
        body.dark-mode .tips-title {
            color: #4da6ff;
            border-bottom: 1px solid #444;
        }
        .tips-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .tip-item {
            padding: 10px 18px;
            background-color: #e8f4fc;
            border-radius: 20px;
            font-size: 15px;
            color: #00529b;
            border: 1px solid #d1e7f5;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        body.dark-mode .tip-item {
            background-color: #163a5c;
            color: #4da6ff;
            border: 1px solid #24507a;
        }
        .tip-item i {
            font-size: 16px;
        }

        /* 24小时气温折线图模块 */
        .hourly-chart-section {
            width: 1200px;
            margin: 20px auto 0;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        body.dark-mode .hourly-chart-section {
            background-color: #2d2d2d;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .chart-title {
            font-size: 18px;
            color: #00529b;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 10px;
        }
        body.dark-mode .chart-title {
            color: #4da6ff;
            border-bottom: 1px solid #444;
        }
        #hourlyTempChart {
            width: 100%;
            height: 300px;
        }

        /* 缩小版留言板模块 */
        .message-section {
            width: 1200px;
            margin: 20px auto 0;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }
        body.dark-mode .message-section {
            background-color: #2d2d2d;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .message-title {
            font-size: 16px;
            color: #00529b;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 8px;
        }
        body.dark-mode .message-title {
            color: #4da6ff;
            border-bottom: 1px solid #444;
        }
        .message-input-wrap {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        #messageInput {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            resize: none;
            height: 60px;
            transition: border-color 0.3s ease;
            background-color: #fff;
            color: #333;
        }
        body.dark-mode #messageInput {
            background-color: #333;
            border-color: #555;
            color: #e0e0e0;
        }
        #messageInput:focus {
            border-color: #00529b;
            outline: none;
        }
        body.dark-mode #messageInput:focus {
            border-color: #4da6ff;
        }
        #submitMessage {
            padding: 0 15px;
            background-color: #00529b;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        body.dark-mode #submitMessage {
            background-color: #0066cc;
        }
        #submitMessage:hover {
            background-color: #0066cc;
            box-shadow: 0 2px 6px rgba(0, 82, 155, 0.3);
        }
        body.dark-mode #submitMessage:hover {
            background-color: #1a75ff;
            box-shadow: 0 2px 6px rgba(77, 166, 255, 0.3);
        }
        .message-list {
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid #f5f5f5;
            padding-top: 10px;
        }
        body.dark-mode .message-list {
            border-top: 1px solid #444;
        }
        .message-item {
            padding: 8px 12px;
            background-color: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        body.dark-mode .message-item {
            background-color: #333;
        }
        .message-item .message-time {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
        }
        body.dark-mode .message-item .message-time {
            color: #bbb;
        }
        .message-item .message-content {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }
        body.dark-mode .message-item .message-content {
            color: #e0e0e0;
        }
        .empty-message {
            text-align: center;
            color: #999;
            font-size: 14px;
            padding: 15px 0;
        }
        body.dark-mode .empty-message {
            color: #bbb;
        }

        /* 底部信息模块样式 */
        .footer-info {
            width: 100%;
            background-color: #fff;
            border-top: 1px solid #e5e5e5;
            padding: 15px 0;
            margin-top: 30px;
        }
        body.dark-mode .footer-info {
            background-color: #2d2d2d;
            border-top: 1px solid #444;
        }
        .footer-wrap {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #666;
        }
        body.dark-mode .footer-wrap {
            color: #ccc;
        }
        .footer-item {
            margin: 0 10px;
        }
        .footer-item a {
            color: #00529b;
            text-decoration: none;
        }
        body.dark-mode .footer-item a {
            color: #4da6ff;
        }
        .footer-item a:hover {
            text-decoration: underline;
        }
    </style>
    <!-- 保留 Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 移除和风天气图标CSS -->
    <!-- 引入ECharts用于绘制折线图 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
</head>
<body>
    <!-- 头部：LOGO + 搜索框 + 日夜模式切换 -->
    <div class="header">
        <div class="container header-wrap">
            <div class="logo-container">
                <i class="fas fa-cloud-sun-rain"></i>
                <span>天气查询</span>
            </div>
            <div class="search-container">
                <input type="text" id="cityInput" placeholder="请输入城市名称">
                <button id="searchBtn">查询</button>
            </div>
            <!-- 日夜模式切换按钮 -->
            <div class="theme-toggle">
                <div class="toggle-switch" id="themeSwitch">
                    <div class="toggle-slider"></div>
                </div>
                <span class="theme-text" id="themeText">日间模式</span>
            </div>
        </div>
    </div>

    <!-- 导航栏 -->
    <div class="nav-bar">
        <div class="container nav-wrap">
            <div class="nav-item" id="nav-home">首页</div>
            <div class="nav-item" id="nav-weather-live">天气实况</div>
            <div class="nav-item" id="nav-weather-bulletin">气象公报</div>
            <div class="nav-item" id="nav-weather-alarm">气象预警</div>
            <div class="nav-item" id="nav-city-forecast">城市预报</div>
            <div class="nav-item" id="nav-weather-news">天气资讯</div>
            <div class="nav-item" id="nav-weather-topic">气象专题</div>
            <div class="nav-item" id="nav-weather-science">气象科普</div>
        </div>
    </div>

    <!-- 天气主内容：当前天气 + 未来预报 -->
    <div class="container">
        <div class="weather-main">
            <!-- 当前天气 -->
            <div class="current-weather-container">
                <div class="city-time-container">
                    <span id="cityName">北京市</span>
                    <span id="updateTime">2025-01-01 12:00</span>
                </div>
                <div class="temp-container">
                    <!-- 修改：替换为 Font Awesome 图标 -->
                    <i id="currentIcon" class="weather-icon fas fa-sun"></i>
                    <span class="temp-value" id="currentTemp">25℃</span>
                </div>
                <div class="details-container">
                    <div class="detail-item">
                        <span>降水</span>
                        <span id="precip">0mm</span>
                    </div>
                    <div class="detail-item">
                        <span id="windDirTitle">西北风</span>
                        <span id="windScaleText">微风</span>
                    </div>
                    <div class="detail-item">
                        <span>湿度</span>
                        <span id="humidity">50%</span>
                    </div>
                    <div class="detail-item">
                        <span>气压</span>
                        <span id="pressure">1010hPa</span>
                    </div>
                </div>
            </div>

            <!-- 未来7天预报 -->
            <div class="forecast-container">
                <div class="forecast-day-container" id="forecast1">
                    <span>今天</span>
                    <span class="forecast-date">12/12</span>
                    <!-- 修改：替换为 Font Awesome 图标 -->
                    <i class="forecast-icon fas fa-sun"></i>
                    <span class="forecast-temp">25℃</span>
                    <span class="forecast-text">晴</span>
                    <span class="forecast-wind-scale">微风</span>
                </div>
                <div class="forecast-day-container" id="forecast2">
                    <span>明天</span>
                    <span class="forecast-date">12/13</span>
                    <i class="forecast-icon fas fa-sun"></i>
                    <span class="forecast-temp">24℃</span>
                    <span class="forecast-text">晴</span>
                    <span class="forecast-wind-scale">软风</span>
                </div>
                <div class="forecast-day-container" id="forecast3">
                    <span>后天</span>
                    <span class="forecast-date">12/14</span>
                    <i class="forecast-icon fas fa-sun"></i>
                    <span class="forecast-temp">26℃</span>
                    <span class="forecast-text">晴</span>
                    <span class="forecast-wind-scale">轻风</span>
                </div>
                <div class="forecast-day-container" id="forecast4">
                    <span>周五</span>
                    <span class="forecast-date">12/15</span>
                    <i class="forecast-icon fas fa-cloud"></i>
                    <span class="forecast-temp">23℃</span>
                    <span class="forecast-text">阴</span>
                    <span class="forecast-wind-scale">和风</span>
                </div>
                <div class="forecast-day-container" id="forecast5">
                    <span>周六</span>
                    <span class="forecast-date">12/16</span>
                    <i class="forecast-icon fas fa-cloud-showers-heavy"></i>
                    <span class="forecast-temp">22℃</span>
                    <span class="forecast-text">小雨</span>
                    <span class="forecast-wind-scale">轻劲风</span>
                </div>
                <div class="forecast-day-container" id="forecast6">
                    <span>周日</span>
                    <span class="forecast-date">12/17</span>
                    <i class="forecast-icon fas fa-cloud-sun"></i>
                    <span class="forecast-temp">24℃</span>
                    <span class="forecast-text">多云</span>
                    <span class="forecast-wind-scale">强风</span>
                </div>
                <div class="forecast-day-container" id="forecast7">
                    <span>周一</span>
                    <span class="forecast-date">12/18</span>
                    <i class="forecast-icon fas fa-sun"></i>
                    <span class="forecast-temp">25℃</span>
                    <span class="forecast-text">晴</span>
                    <span class="forecast-wind-scale">疾风</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 天气提示模块 -->
    <div class="weather-tips-section">
        <div class="tips-title">生活提示</div>
        <div class="tips-list" id="tipsList">
            <!-- 提示内容由JS动态生成 -->
        </div>
    </div>

    <!-- 24小时气温折线图模块 -->
    <div class="hourly-chart-section">
        <div class="chart-title">24小时气温变化</div>
        <div id="hourlyTempChart"></div>
    </div>

    <!-- 缩小版留言框区域 -->
    <div class="message-section">
        <div class="message-title">留言反馈</div>
        <div class="message-input-wrap">
            <textarea id="messageInput" placeholder="请输入您的留言内容..."></textarea>
            <button id="submitMessage">提交</button>
        </div>
        <div class="message-list" id="messageList">
            <div class="empty-message">暂无留言，快来发表第一条留言吧！</div>
        </div>
    </div>

    <!-- 底部信息模块 -->
    <footer class="footer-info">
        <div class="container footer-wrap">
            <div class="footer-item">API调用次数：<span id="apiCallCount">0</span> 次</div>
            <div class="footer-item">数据来源：<a href="https://www.qweather.com/" target="_blank">和风天气</a></div>
            <div class="footer-item">作者：<span>珠科.软工.20240132.杨嘉</span></div>
        </div>
    </footer>

    <script>
        // 天气API配置
        const WEATHER_API_KEY = "a5eb5ea758be41e781c4e9abb4f87f9b";
        const GEO_API_KEY = "5638a2b16b52469f9bdbbacab0af5c69";
        const WEATHER_BASE_URL = "https://p82mtefeqv.re.qweatherapi.com/v7/weather/now";
        const GEO_BASE_URL = "https://p82mtefeqv.re.qweatherapi.com/geo/v2/city/lookup";
        const FORECAST_URL = "https://p82mtefeqv.re.qweatherapi.com/v7/weather/7d";
        const HOURLY_URL = "https://p82mtefeqv.re.qweatherapi.com/v7/weather/24h"; // 24小时预报接口

        // 新增：和风天气代码到 Font Awesome 图标的映射
        const weatherIconMap = {
            // 晴
            '100': 'fas fa-sun',
            // 多云
            '101': 'fas fa-cloud-sun',
            '102': 'fas fa-cloud-sun',
            '103': 'fas fa-cloud-sun',
            // 阴
            '104': 'fas fa-cloud',
            // 小雨
            '300': 'fas fa-cloud-rain',
            '301': 'fas fa-cloud-showers-light',
            '302': 'fas fa-cloud-showers-heavy',
            // 中雨
            '303': 'fas fa-cloud-showers-heavy',
            '304': 'fas fa-cloud-showers-heavy',
            // 大雨
            '305': 'fas fa-cloud-burst',
            '306': 'fas fa-cloud-burst',
            '307': 'fas fa-cloud-burst',
            // 暴雨
            '308': 'fas fa-cloud-pouring',
            '309': 'fas fa-cloud-pouring',
            '310': 'fas fa-cloud-pouring',
            // 雪
            '400': 'fas fa-snowflake',
            '401': 'fas fa-snowflake',
            '402': 'fas fa-snowflake',
            '403': 'fas fa-snowflake',
            '404': 'fas fa-snowflake',
            '405': 'fas fa-snowflake',
            '406': 'fas fa-snowflake',
            '407': 'fas fa-snowflake',
            // 雷阵雨
            '309': 'fas fa-bolt',
            '311': 'fas fa-bolt',
            '312': 'fas fa-bolt',
            '313': 'fas fa-bolt',
            // 雾/霾
            '500': 'fas fa-smog',
            '501': 'fas fa-smog',
            '502': 'fas fa-smog',
            '503': 'fas fa-smog',
            '504': 'fas fa-smog',
            '507': 'fas fa-smog',
            '508': 'fas fa-smog',
            '509': 'fas fa-wind',
            '510': 'fas fa-wind',
            '511': 'fas fa-wind',
            '512': 'fas fa-wind',
            // 沙尘
            '513': 'fas fa-dust',
            '514': 'fas fa-dust',
            '515': 'fas fa-dust',
            // 默认
            'default': 'fas fa-cloud-sun'
        };

        // 风力等级对应文字
        const windScaleMap = [
            "无风", "软风", "轻风", "微风", "和风", 
            "轻劲风", "强风", "疾风", "大风", "烈风", 
            "狂风", "暴风", "飓风"
        ];

        // DOM元素
        const cityInput = document.getElementById('cityInput');
        const searchBtn = document.getElementById('searchBtn');
        const cityName = document.getElementById('cityName');
        const updateTime = document.getElementById('updateTime');
        const currentIcon = document.getElementById('currentIcon');
        const currentTemp = document.getElementById('currentTemp');
        const precip = document.getElementById('precip');
        const windDirTitle = document.getElementById('windDirTitle');
        const windScaleText = document.getElementById('windScaleText');
        const humidity = document.getElementById('humidity');
        const pressure = document.getElementById('pressure');
        const apiCallCountEl = document.getElementById('apiCallCount');
        const tipsList = document.getElementById('tipsList'); // 提示列表DOM
        let apiCallCount = 0;

        // 日夜模式相关元素
        const themeSwitch = document.getElementById('themeSwitch');
        const themeText = document.getElementById('themeText');
        const body = document.body;

        // 初始化24小时气温图表
        let hourlyChart;
        function initHourlyChart() {
            const chartDom = document.getElementById('hourlyTempChart');
            hourlyChart = echarts.init(chartDom);
            
            // 根据当前主题设置图表样式
            const isDark = body.classList.contains('dark-mode');
            const textColor = isDark ? '#e0e0e0' : '#333';
            const gridColor = isDark ? '#444' : '#e5e5e5';
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    textStyle: { color: textColor },
                    formatter: '{b} <br/>气温: {c}℃'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    axisLine: { lineStyle: { color: gridColor } },
                    axisLabel: { color: textColor },
                    data: []
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: gridColor } },
                    axisLabel: { 
                        color: textColor,
                        formatter: '{value}℃'
                    },
                    splitLine: { lineStyle: { color: gridColor, type: 'dashed' } }
                },
                series: [
                    {
                        name: '气温',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: {
                            width: 3,
                            color: isDark ? '#4da6ff' : '#00529b'
                        },
                        itemStyle: {
                            color: isDark ? '#4da6ff' : '#00529b'
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: isDark ? 'rgba(77, 166, 255, 0.3)' : 'rgba(0, 82, 155, 0.3)' },
                                { offset: 1, color: isDark ? 'rgba(77, 166, 255, 0)' : 'rgba(0, 82, 155, 0)' }
                            ])
                        },
                        symbol: 'circle',
                        symbolSize: 6
                    }
                ]
            };
            hourlyChart.setOption(option);
        }

        // 更新24小时气温图表数据
        function updateHourlyChart(hourlyData) {
            if (!hourlyChart) initHourlyChart();
            
            const hours = hourlyData.map(item => {
                const time = item.fxTime.split('T')[1].substring(0, 5); // 提取 HH:MM
                return time;
            });
            const temps = hourlyData.map(item => parseInt(item.temp));
            
            // 根据当前主题更新图表样式
            const isDark = body.classList.contains('dark-mode');
            const lineColor = isDark ? '#4da6ff' : '#00529b';
            
            const option = {
                xAxis: { data: hours },
                series: [
                    {
                        data: temps,
                        lineStyle: { color: lineColor },
                        itemStyle: { color: lineColor },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: isDark ? 'rgba(77, 166, 255, 0.3)' : 'rgba(0, 82, 155, 0.3)' },
                                { offset: 1, color: isDark ? 'rgba(77, 166, 255, 0)' : 'rgba(0, 82, 155, 0)' }
                            ])
                        }
                    }
                ]
            };
            hourlyChart.setOption(option);
        }

        // 切换日夜模式
        function toggleTheme() {
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            themeText.textContent = isDark ? '夜间模式' : '日间模式';
            
            // 保存主题偏好到本地存储
            localStorage.setItem('weatherTheme', isDark ? 'dark' : 'light');
            
            // 更新图表样式
            if (hourlyChart) {
                initHourlyChart();
                // 如果已有数据，重新渲染
                if (hourlyChart.getOption().xAxis[0].data.length > 0) {
                    const option = hourlyChart.getOption();
                    hourlyChart.setOption(option);
                }
            }
        }

        // 生成天气提示的核心函数
        function generateWeatherTips(nowData, hourlyData, dailyData) {
            const tips = [];
            const currentTemp = parseInt(nowData.temp);
            const todayTempMin = parseInt(dailyData[0].tempMin);
            const todayTempMax = parseInt(dailyData[0].tempMax);
            const tempDiff = todayTempMax - todayTempMin; // 昼夜温差

            // 1. 降水相关提示
            if (parseFloat(nowData.precip) > 0) {
                tips.push({
                    text: "当前正在降水，记得携带雨具",
                    icon: "fas fa-umbrella"
                });
            } else {
                // 检查未来3小时是否有降水
                const next3Hours = hourlyData.slice(0, 3);
                const hasRain = next3Hours.some(item => parseFloat(item.precip) > 0);
                if (hasRain) {
                    tips.push({
                        text: "三小时之内会下雨，建议携带雨具",
                        icon: "fas fa-cloud-showers-heavy"
                    });
                }
            }

            // 2. 温差相关提示
            if (tempDiff >= 10) {
                tips.push({
                    text: "白天温度适中，但早晚偏凉，注意增减衣物",
                    icon: "fas fa-temperature-half"
                });
            } else if (tempDiff >= 5) {
                tips.push({
                    text: "昼夜温差较大，建议准备薄外套",
                    icon: "fas fa-shirt"
                });
            }

            // 3. 温度相关提示
            if (currentTemp <= 10) {
                tips.push({
                    text: "气温较低，注意保暖，携带厚外套",
                    icon: "fas fa-snowflake"
                });
            } else if (currentTemp <= 18) {
                tips.push({
                    text: "气温微凉，建议携带薄外套",
                    icon: "fas fa-jacket"
                });
            } else if (currentTemp >= 30) {
                tips.push({
                    text: "气温较高，注意防暑降温",
                    icon: "fas fa-temperature-high"
                });
            }

            // 4. 天气状况相关提示
            if (nowData.text === "晴" && todayTempMax >= 28) {
                tips.push({
                    text: "今日晴天且气温较高，注意防晒",
                    icon: "fas fa-sun"
                });
            } else if (nowData.text === "阴" || nowData.text === "多云") {
                tips.push({
                    text: "今日多云转阴，体感舒适",
                    icon: "fas fa-cloud"
                });
            }

            // 渲染提示到页面
            tipsList.innerHTML = '';
            if (tips.length === 0) {
                tipsList.innerHTML = `
                    <div class="tip-item">
                        <i class="fas fa-smile"></i>
                        <span>今日天气良好，适宜出行</span>
                    </div>
                `;
                return;
            }
            
            tips.forEach(tip => {
                const tipItem = document.createElement('div');
                tipItem.className = 'tip-item';
                tipItem.innerHTML = `
                    <i class="${tip.icon}"></i>
                    <span>${tip.text}</span>
                `;
                tipsList.appendChild(tipItem);
            });
        }

        // 导航栏点击事件绑定
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化图表
            initHourlyChart();
            // 读取本地存储的主题偏好
            const savedTheme = localStorage.getItem('weatherTheme');
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                themeText.textContent = '夜间模式';
            }
            
            // 绑定主题切换事件
            themeSwitch.addEventListener('click', toggleTheme);

            document.getElementById('nav-home').addEventListener('click', function() {
                window.location.reload();
            });

            document.getElementById('nav-weather-live').addEventListener('click', function() {
                window.open('https://weather.cma.cn/web/channel-2b0863600e144b13807e606f928b1266.html', '_blank');
            });

            document.getElementById('nav-weather-bulletin').addEventListener('click', function() {
                window.open('https://weather.cma.cn/web/channel-380.html', '_blank');
            });

            document.getElementById('nav-weather-alarm').addEventListener('click', function() {
                window.open('https://weather.cma.cn/web/alarm/map.html', '_blank');
            });

            document.getElementById('nav-city-forecast').addEventListener('click', function() {
                window.open('https://weather.cma.cn/web/weather/map.html', '_blank');
            });

            document.getElementById('nav-weather-news').addEventListener('click', function() {
                window.open('https://www.cma.gov.cn', '_blank');
            });

            document.getElementById('nav-weather-topic').addEventListener('click', function() {
                window.open('https://www.cma.gov.cn/2011xwzx/2011xztbd/', '_blank');
            });

            document.getElementById('nav-weather-science').addEventListener('click', function() {
                window.open('https://www.qxkp.net', '_blank');
            });

            // 留言框提交事件
            const messageInput = document.getElementById('messageInput');
            const submitMessage = document.getElementById('submitMessage');
            const messageList = document.getElementById('messageList');

            submitMessage.addEventListener('click', function() {
                const content = messageInput.value.trim();
                if (!content) {
                    alert('请输入留言内容！');
                    return;
                }

                const now = new Date();
                const timeStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                
                const messageItem = document.createElement('div');
                messageItem.className = 'message-item';
                messageItem.innerHTML = `
                    <div class="message-time">${timeStr}</div>
                    <div class="message-content">${content}</div>
                `;

                if (messageList.querySelector('.empty-message')) {
                    messageList.innerHTML = '';
                }
                messageList.appendChild(messageItem);

                messageInput.value = '';
                messageList.scrollTop = messageList.scrollHeight;
            });

            messageInput.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    submitMessage.click();
                }
            });
            
            // 监听窗口大小变化，重新调整图表
            window.addEventListener('resize', function() {
                if (hourlyChart) hourlyChart.resize();
            });
        });

        // 页面加载默认查询北京天气
        window.onload = () => {
            getWeatherByCity('北京市');
        }

        // 搜索按钮点击事件
        searchBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();
            if (city) {
                getWeatherByCity(city);
            } else {
                alert('请输入城市名称');
            }
        });

        // 按回车键搜索
        cityInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });

        // 根据城市名获取天气
        async function getWeatherByCity(city) {
            try {
                apiCallCount++;
                apiCallCountEl.textContent = apiCallCount;

                // 地理编码获取locationId
                const geoRes = await fetch(`${GEO_BASE_URL}?key=${GEO_API_KEY}&location=${city}`);
                const geoData = await geoRes.json();
                if (geoData.code !== '200' || !geoData.location || geoData.location.length === 0) {
                    alert('未找到该城市，请检查名称');
                    return;
                }
                const locationId = geoData.location[0].id;
                cityName.textContent = geoData.location[0].name;

                // 获取实时天气
                const weatherRes = await fetch(`${WEATHER_BASE_URL}?key=${WEATHER_API_KEY}&location=${locationId}`);
                const weatherData = await weatherRes.json();
                if (weatherData.code !== '200') {
                    alert('获取实时天气失败');
                    return;
                }
                updateCurrentWeather(weatherData.now);

                // 获取未来7天预报
                const forecastRes = await fetch(`${FORECAST_URL}?key=${WEATHER_API_KEY}&location=${locationId}`);
                const forecastData = await forecastRes.json();
                if (forecastData.code !== '200') {
                    alert('获取预报数据失败');
                    return;
                }
                updateForecast(forecastData.daily);

                // 获取24小时预报
                const hourlyRes = await fetch(`${HOURLY_URL}?key=${WEATHER_API_KEY}&location=${locationId}`);
                const hourlyData = await hourlyRes.json();
                if (hourlyData.code === '200') {
                    updateHourlyChart(hourlyData.hourly);
                    // 生成天气提示
                    generateWeatherTips(weatherData.now, hourlyData.hourly, forecastData.daily);
                }

            } catch (error) {
                console.error('请求天气数据失败：', error);
                alert('网络错误，请稍后重试');
            }
        }

        // 更新实时天气数据
        function updateCurrentWeather(nowData) {
            // 处理更新时间
            const updateTimeStr = nowData.updateTime;
            if (updateTimeStr && updateTimeStr.includes('T')) {
                const [datePart, timePart] = updateTimeStr.split('T');
                const [timeMain] = timePart.split('+');
                const [hour, minute] = timeMain.split(':');
                updateTime.textContent = `${datePart} ${hour}:${minute}`;
            } else if (updateTimeStr) {
                updateTime.textContent = updateTimeStr;
            } else {
                const now = new Date();
                updateTime.textContent = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            }

            // 修改：更新 Font Awesome 天气图标
            currentTemp.textContent = `${nowData.temp}℃`;
            const iconClass = weatherIconMap[nowData.icon] || weatherIconMap['default'];
            currentIcon.className = `weather-icon ${iconClass}`;

            // 更新详细信息
            precip.textContent = `${nowData.precip || 0}mm`;
            windDirTitle.textContent = nowData.windDir || '未知风向';
            const windScaleNum = Math.min(parseInt(nowData.windScale || 0), 12);
            windScaleText.textContent = windScaleMap[windScaleNum] || '未知';
            humidity.textContent = `${nowData.humidity || 0}%`;
            pressure.textContent = `${nowData.pressure || 0}hPa`;
        }

        // 更新未来7天预报
        function updateForecast(dailyData) {
            const dayNames = ['今天', '明天', '后天', '周五', '周六', '周日', '周一'];
            for (let i = 0; i < 7; i++) {
                const dayData = dailyData[i];
                const forecastEl = document.getElementById(`forecast${i+1}`);
                
                // 相对日期
                forecastEl.children[0].textContent = dayNames[i];
                
                // 具体日期
                const dateParts = dayData.fxDate.split('-');
                forecastEl.children[1].textContent = `${dateParts[1]}/${dateParts[2]}`;
                
                // 修改：更新 Font Awesome 预报图标
                const iconClass = weatherIconMap[dayData.iconDay] || weatherIconMap['default'];
                forecastEl.children[2].className = `forecast-icon ${iconClass}`;
                
                // 温度区间
                forecastEl.children[3].textContent = `${dayData.tempMin}~${dayData.tempMax}℃`;
                
                // 天气状态
                const weatherText = dayData.textDay === dayData.textNight 
                    ? dayData.textDay 
                    : `${dayData.textDay}转${dayData.textNight}`;
                forecastEl.children[4].textContent = weatherText;
                
                // 风力
                const dayWindScale = Math.min(parseInt(dayData.windScaleDay || 0), 12);
                const nightWindScale = Math.min(parseInt(dayData.windScaleNight || 0), 12);
                const maxWindScale = Math.max(dayWindScale, nightWindScale);
                forecastEl.children[5].textContent = windScaleMap[maxWindScale] || '未知';
            }
        }
    </script>
</body>
</html>
